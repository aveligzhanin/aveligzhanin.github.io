<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Параллелизм и согласованность данных</title>

    <!-- Bootstrap -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>

    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css">
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>

    <!-- Our style -->
    <link rel="stylesheet" type="text/css" href="/assets/css/styles.css">
	<link rel="stylesheet" type="text/css" href="/assets/css/avel.css">
</head>

  <body>
    <nav class="navbar navbar-expand-lg navbar-light bg-light navbar-fixed-top">
  <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="#">Сайт Велигжанина Андрея</a>
        </div>
        <div id="navbar" class="navbar-collapse collapse menu">
			<ul class="nav navbar-nav navbar-right">
                 
                    <li>
                       <a href="/index.html#about">Обо мне</a>
                    </li>
                 
                    <li>
                       <a href="/index.html#education">Образование</a>
                    </li>
                 
                    <li>
                       <a href="/index.html#work">Работа</a>
                    </li>
                 
                    <li>
                       <a href="/index.html#skills">Навыки</a>
                    </li>
                 
                    <li>
                       <a href="/index.html#portfolio">Портфолио</a>
                    </li>
                 
                    <li>
                       <a href="/index.html#hobby">Увлечения</a>
                    </li>
                 
                    <li>
                       <a href="/index.html#contact">Контакты</a>
                    </li>
                 
        	</ul>
        </div>
      </div>
  </div>
</nav>

    <section class="pfblock"><div class="container">  		<!-- Translations -->
	<div class="col-xs-6" align=left>
		<a href="/index.html">home</a> \ <a href="/pages/skills/oracle/concepts.html">Oracle. Database Concepts</a>
	</div>

	<div class="col-xs-6" align=right>
		Написано: 05.04.2023
	</div>

   	<div class="col-sm-12 my">
		<h1 id="11-параллелизм-и-согласованность-данных"><a href="https://docs.oracle.com/en/database/oracle/oracle-database/21/cncpt/data-concurrency-and-consistency.html#GUID-E8CBA9C5-58E3-460F-A82A-850E0152E95C">11. Параллелизм и согласованность данных</a></h1>

<p>В этой главе объясняется, как Oracle поддерживает согласованность данных в многопользовательской среде БД.</p>

<h2 id="введение-в-параллелизм-concurrency-и-согласованность-consistency-данных">Введение в параллелизм (Concurrency) и согласованность (Consistency) данных</h2>

<p>В однопользовательской базе данных пользователь может изменять данные, не беспокоясь о том, что другие пользователи изменяют те же данные одновременно. Однако в многопользовательской базе данных инструкции в рамках нескольких одновременных транзакций могут обновлять одни и те же данные. Транзакции, выполняемые одновременно, должны приводить к значимым и последовательным результатам.</p>

<p>Многопользовательская база данных должна обеспечивать следующее:</p>

<ul>
  <li>
    <p>гарантировать, что пользователи могут получать доступ к данным одновременно (<strong>параллелизм данных</strong>)</p>
  </li>
  <li>
    <p>гарантировать, что каждый пользователь видит согласованное представление данных (<strong>data consistency</strong>), включая видимые изменения, внесенные в результате собственных транзакций пользователя и совершенных транзакций других пользователей</p>
  </li>
</ul>

<p>Чтобы описать согласованное поведение транзакций при одновременном выполнении транзакций, исследователи БД определили модель изоляции транзакций, называемую <strong>сериализуемостью</strong>. Сериализуемая транзакция выполняется в среде, которая создает впечатление, что никакие другие пользователи не изменяли данные в БД.</p>

<p>Хотя такая степень изоляции между транзакциями, как правило, желательна, запуск многих приложений в сериализуемом режиме может серьезно снизить пропускную способность приложений. Полная изоляция одновременно выполняемых транзакций может означать, что одна транзакция не может выполнить вставку в таблицу, запрашиваемую другой транзакцией. Короче говоря, реальные соображения обычно требуют компромисса между идеальной изоляцией транзакций и производительностью.</p>

<p>БД Oracle поддерживает согласованность данных с помощью многоверсионной модели согласованности и различных типов блокировок и транзакций. Таким образом, БД может представлять представление данных нескольким одновременным пользователям, причем каждое представление соответствует определенному моменту времени. Поскольку разные версии блоков данных могут существовать одновременно, транзакции могут считывать версию данных, зафиксированную в момент времени, требуемый <strong>запросом</strong>, и вернуть результаты, которые соответствуют одному моменту времени.</p>

<h3 id="согласованность-многоверсионного-чтения">Согласованность многоверсионного чтения</h3>

<p>В БД Oracle <strong>мультиверсионность</strong> – это возможность одновременной материализации нескольких версий данных. БД Oracle поддерживает согласованность чтения в нескольких версиях.</p>

<p>Запросы к базе данных Oracle обладают следующими характеристиками:</p>

<ul>
  <li>
    <p>Запросы, согласованные с чтением<br />Данные, возвращаемые запросом, фиксируются и непротиворечивы для одного момента времени.<br /><strong>Примечание</strong>: БД Oracle никогда не разрешает <strong>грязное чтение</strong>, которое происходит, когда транзакция считывает данные, незафиксированные в другой транзакции.<br />Чтобы проиллюстрировать проблему с грязным чтением, предположим, что одна транзакция обновляет значение столбца без фиксации. Вторая транзакция считывает обновленное и грязное (незафиксированное) значение. Первый сеанс откатывает транзакцию, так что столбец сохраняет свое старое значение, но вторая транзакция продолжается, используя обновленное значение, повреждая БД. Грязные операции чтения нарушают целостность данных, нарушают внешние ключи и игнорируют уникальные ограничения.</p>
  </li>
  <li>
    <p>Неблокирующие запросы<br />Устройства чтения и записи данных не блокируют друг друга.</p>
  </li>
</ul>

<h4 id="согласованность-чтения-уровня-выражений"><strong>Согласованность чтения уровня выражений</strong></h4>

<p>БД Oracle всегда обеспечивает согласованность чтения на уровне инструкций, что гарантирует, что данные, возвращаемые одним запросом, зафиксированы и непротиворечивы в течение одного момента времени.</p>

<p>Момент времени, до которого один оператор SQL является согласованным, зависит от уровня изоляции транзакции и характера запроса:</p>

<ul>
  <li>
    <p>На уровне изоляции зафиксированного чтения (read commited) этот момент является временем, в которое была открыта инструкция. Например, если оператор SELECT открывается в SCN 1000, то этот оператор соответствует SCN 1000.</p>
  </li>
  <li>
    <p>В сериализуемой транзакции (доступной только для чтения), этот момент является временем начала транзакции. Например, если транзакция начинается с SCN 1000, и если в этой транзакции встречается несколько инструкций SELECT, то каждая инструкция соответствует SCN 1000.</p>
  </li>
  <li>
    <p>В операции ретроспективного запроса (SELECT … AS OF), оператор SELECT явно указывает момент времени. Например, вы можете запросить таблицу в том виде, в каком она появилась в прошлый четверг в 14:00.</p>
  </li>
</ul>

<h4 id="согласованность-чтения-уровня-транзакций"><strong>Согласованность чтения уровня транзакций</strong></h4>

<p>БД Oracle также может обеспечивать согласованность чтения для всех запросов в транзакции, известную как согласованность чтения на уровне транзакции.</p>

<p>В этом случае каждый оператор в транзакции видит данные из одного и того же момента времени. Это время, в которое началась транзакция.</p>

<p>Запросы, выполняемые сериализуемой транзакцией, видят изменения, внесенные самой транзакцией. Например, транзакция, которая обновляет сотрудников, а затем запрашивает сотрудников, увидит обновления. Согласованность чтения на уровне транзакции обеспечивает повторяемые чтения и не подвергает запрос фантомным чтениям.</p>

<h4 id="согласованность-чтения-и-undo-сегменты"><strong>Согласованность чтения и Undo-сегменты</strong></h4>

<p>Чтобы управлять многоверсионной моделью согласованности чтения, БД должна создавать согласованный с чтением набор данных при одновременном запросе и обновлении таблицы.</p>

<p>БД Oracle обеспечивает согласованность чтения за счет данных Undo.</p>

<p>Всякий раз, когда пользователь изменяет данные, база данных Oracle создает записи Undo, которые она записывает в сегменты Undo. Сегменты Undo содержат старые значения данных, которые были изменены незафиксированными или недавно зафиксированными транзакциями. Таким образом, в БД может существовать несколько версий одних и тех же данных, все в разные моменты времени. БД может использовать моментальные снимки данных в разные моменты времени, чтобы обеспечить согласованное с чтением представление данных и включить неблокирующие запросы.</p>

<p>Согласованность чтения гарантируется в средах с одним экземпляром и Oracle Real Application Clusters (Oracle RAC). Oracle RAC использует механизм передачи блоков из кэша в кэш, известный как <code class="language-plaintext highlighter-rouge">cache fusion</code>, для передачи совместимых с чтением образов блоков данных из одного экземпляра БД в другой.</p>

<h5 id="согласованность-чтения-пример"><strong>Согласованность чтения: пример</strong></h5>

<p>В этом примере показан запрос, который использует данные Undo для обеспечения согласованности чтения на уровне инструкции на уровне изоляции зафиксированного чтения.</p>

<p><img src="/assets/images/oracon_fig11_1.jpg" alt="OraCon_Fig11_1" /></p>

<p>Поскольку БД извлекает блоки данных от имени запроса, БД гарантирует, что данные в каждом блоке отражают содержимое блока на момент начала запроса. БД откатывает изменения в блоке по мере необходимости, чтобы восстановить блок до момента начала обработки запроса.</p>

<h5 id="согласованность-чтения-и-список-заинтересованных-транзакций-itl--interested-transaction-list"><strong>Согласованность чтения и список заинтересованных транзакций (ITL – interested transaction list)</strong></h5>

<h4 id="согласованность-чтения-и-отложенные-вставки"><strong>Согласованность чтения и отложенные вставки</strong></h4>

<h3 id="механизм-блокирования">Механизм блокирования</h3>

<h3 id="уровни-изоляции-транзакций-ansiiso">Уровни изоляции транзакций ANSI/ISO</h3>

<h2 id="обзор-уровней-изоляции-транзакций-бд-oracle">Обзор уровней изоляции транзакций БД Oracle</h2>

<h2 id="обзор-механизма-блокирования-бд-oracle">Обзор механизма блокирования БД Oracle</h2>

<h2 id="обзор-автоматического-блокирования">Обзор автоматического блокирования</h2>

<h2 id="обзор-ручного-блокирования-данных">Обзор ручного блокирования данных</h2>

<h2 id="обзор-блокирования-определяемого-пользователем">Обзор блокирования, определяемого пользователем</h2>

<p><br /><br /><br /><br /><br /><br /><br /></p>
<div class="row">
  <div class="col"><div align="left"><a href="/pages/skills/oracle/concept/10plsql.html">&#8592; 10. Программирование на стороне сервера: PL/SQL и Java.</a></div>
  </div>
  <div class="col"><div align="right"><a href="/pages/skills/oracle/concept/12transactions.html">12. Транзакции &#8594;</a></div> 
 </div> 
</div>

   	</div>
</div></section>

    <footer class="footer hexlet-footer py-5 mt-5 text-muted">
  <div class="container">
    <div class="row mt-1">
      <div class="col-12 text-center">
        <a href="https://aveligzhanin.github.io/">Велигжанин Андрей</a> — Программист-разработчик C++ и Oracle.
      </div>
    </div>
  </div>
</footer>

  </body>
</html>